/* ==========================================================================
   Performer
   ========================================================================== */

import React from 'react'
import MetaTags from 'react-meta-tags'
import { Link } from 'react-router-dom'
import { loadScript } from '../utils'
import Cover from './Cover'
import EventMinicard from './EventMinicard'

if (process.env.WEBPACK) {
  require( '../css/Performer.css' )
}

/* Component definition
   -------------------------------------------------------------------------- */
export default class Performer extends React.Component {

  constructor(props) {
    super(props)
  }

  componentDidMount() {

    // exit if Soundcloud account not found
    if (!this.props.performer.links.sc) return

    // if (window.SC && window.SC.Widget) {
    //   this.initPlayer.call(this)
    // } else {
    //   loadScript("https://w.soundcloud.com/player/api.js")
    //     .then(this.initPlayer.bind(this))
    // }
  }

  render() {

    const {id, name, picture, cover, links, events} = this.props.performer

    const pastEvents = events.filter(e => new Date(e.end_time) < new Date())
    const nextEvents = events.filter(e => new Date(e.end_time) >= new Date())

    // sort upcoming events by date ascending
    nextEvents.sort((a, b) => new Date(a.start_time) - new Date(b.start_time))

    // sort past events by date descending
    pastEvents.sort((a, b) => new Date(b.start_time) - new Date(a.start_time))

    return (
      <div className="Page Page-performer">
        <MetaTags>
          <title>{name}</title>
          <meta id="meta_title" property="og:title" content={name} />
          {cover && <meta id="meta_image" property="og:image" content={cover.source} />}
        </MetaTags>
        <main role="main">
          <div className="Performer">
            {/* {cover && <Cover cover={cover} ratio={0.38} />} */}
            {/* <h1 className={cover ? "" : "noCover"}> */}
            <h1 className="noCover">
              <img src={picture.data.url} alt={"Photo de profil de " + name} />
              {name}
            </h1>
            <div className="Performer-content">
              <div className="Performer-links">
                <span>Ailleurs sur le web&nbsp;:</span>
                <ul>
                  {links.ws &&
                    <li>
                      <a href={links.ws} title={"Site internet de " + name}>
                        <svg className="icon-earth" viewBox="0 0 512 512" aria-hidden="true">
                          <path d="M256 0C114.615 0 0 114.615 0 256s114.615 256 256 256 256-114.615 256-256S397.385 0 256 0zm0 480.001c-31.479 0-61.436-6.506-88.615-18.226L283.959 330.63A16.002 16.002 0 0 0 288 320v-48c0-8.837-7.163-16-16-16-56.495 0-116.102-58.731-116.687-59.313-3-3.001-7.07-4.687-11.313-4.687H80c-8.836 0-16 7.164-16 16v96a15.999 15.999 0 0 0 8.845 14.311L128 345.889v93.943C69.974 399.354 32 332.116 32 256c0-34.357 7.745-66.903 21.569-96H112c4.244 0 8.313-1.686 11.314-4.686l64-64c3-3.001 4.686-7.07 4.686-11.314V41.294C212.281 35.257 233.759 32 256 32c35.203 0 68.502 8.13 98.141 22.6a97.187 97.187 0 0 0-6.023 5.518C329.985 78.25 320 102.357 320 128s9.985 49.75 28.118 67.882c18.217 18.216 42.609 28.132 67.817 28.13 1.583 0 3.171-.04 4.759-.118 6.907 25.901 19.376 93.328-4.202 186.167a15.957 15.957 0 0 0-.421 2.612c-40.662 41.54-97.35 67.328-160.071 67.328z"/>
                        </svg>
                        Site web
                      </a>
                    </li>}
                  {links.fb &&
                    <li>
                      <a href={links.fb} title={"Page Facebook de " + name}>
                        <svg className="icon-facebook" viewBox="0 0 32 32" aria-hidden="true">
                          <path d="M32 30a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h28a2 2 0 0 1 2 2v28z" fill="#3B5998"/>
                          <path d="M22 32V20h4l1-5h-5v-2c0-2 1.002-3 3-3h2V5h-4c-3.675 0-6 2.881-6 7v3h-4v5h4v12h5z" fill="#FFF"/>
                        </svg>
                        Profil Facebook
                      </a>
                    </li>}
                  {links.sc &&
                    <li>
                      <a href={links.sc} title={"Profil SoundCloud de " + name}>
                        <svg className="icon-soundcloud" viewBox="0 0 1024 1024" aria-hidden="true">
                          <path fill="#f30" d="M50.133 521.6c-2.176 0-4.011 1.963-4.309 4.267l-9.941 91.904 9.941 89.813c.299 2.475 2.133 4.181 4.309 4.181 2.133 0 3.84-1.707 4.224-4.181l10.88-89.813-11.52-91.904c0-2.432-1.92-4.267-3.84-4.267zM11.52 556.928c-2.56 0-3.883 1.579-4.437 4.011L0 617.771l7.04 55.808c0 2.347 1.92 4.011 3.84 4.011s3.797-1.92 4.437-4.437l8.96-56.277-8.96-56.917c0-2.603-1.877-3.84-3.84-3.84zm78.037-53.248c-2.603 0-5.12 1.92-5.12 4.437l-8.96 109.355 9.6 104.875c0 2.56 1.92 5.12 5.077 5.12 2.603 0 4.48-2.603 5.163-5.12l10.837-105.557-10.837-108.715c-.683-2.56-2.603-5.12-5.163-5.12zm40.918-4.523c-3.2 0-5.76 2.56-6.4 5.76l-8.235 112.64 8.96 108.544c.683 3.285 3.2 5.888 6.357 5.888 3.2 0 5.76-2.603 6.4-6.4l10.24-108.032-10.24-111.915c0-3.2-2.56-5.76-5.76-5.76l-1.323-.725zm49.28 15.36c-.213-3.84-3.2-6.357-6.784-6.357-3.84 0-6.741 2.56-6.997 6.357l-9.259 103.68 8.533 109.355c0 3.84 3.2 6.699 6.784 6.699 3.157 0 6.315-2.901 6.315-6.741l9.685-109.355-9.685-104.277 1.408.64zm34.517-72.917c-4.309 0-7.68 3.84-7.68 7.723l-8.96 168.832 7.979 109.355c0 3.84 3.413 6.997 7.68 6.997 4.011 0 7.424-3.84 7.68-7.68l8.917-109.355L220.971 448c-.341-4.437-3.755-7.68-7.68-7.68zm39.936-40.277c-4.48 0-8.32 3.84-8.661 8.277l-7.68 207.872 7.04 108.715c0 5.12 3.84 8.917 8.32 8.917 4.437 0 8.277-3.797 8.96-8.917l8.235-108.715-8.192-207.189c-.683-5.12-4.48-8.96-8.96-8.96zm41.259-19.158c-5.163 0-9.003 3.797-9.6 8.917l-7.04 225.067 7.04 107.52c.597 5.077 4.437 9.6 9.6 9.6 5.077 0 9.6-4.48 9.6-9.6l8.32-107.52-8.363-225.067c0-5.12-4.48-9.6-9.6-9.6zm53.077 1.238c0-5.76-4.48-10.24-10.24-10.24-5.077 0-10.24 4.48-10.24 10.24l-6.357 232.149 6.357 106.795c.683 5.76 5.163 10.24 10.923 10.24s10.24-4.48 10.24-10.24l6.997-106.795-6.997-232.789-.683.64zm31.957-5.718c-5.76 0-10.88 5.077-10.88 10.837l-6.4 227.072 6.4 105.515c0 6.4 5.12 10.88 10.88 10.88s10.88-5.12 10.88-11.52l6.4-105.557-7.04-226.432c0-6.315-5.12-11.52-11.563-11.52zm41.558 6.358c-6.997 0-12.117 5.76-12.117 12.16l-4.395 219.435 5.76 105.557c0 6.357 5.077 11.819 12.117 11.819 6.357 0 11.563-5.12 12.117-12.16l5.163-104.235-5.76-218.112c-.512-6.997-5.76-12.16-12.16-12.16zm51.242-38.016c-1.92-1.237-4.48-1.877-7.04-1.877s-5.077.64-7.04 1.877c-3.84 2.304-6.357 6.4-6.357 10.88v2.603l-4.437 258.048 4.907 104.491v.341c.341 2.56 1.28 5.76 3.157 7.68 2.475 2.603 6.059 4.437 9.984 4.437 3.413 0 6.741-1.877 8.917-3.84 2.475-2.56 3.883-5.76 3.883-9.6l.64-10.24 4.992-93.995-5.76-259.669c0-4.437-2.603-8.235-5.76-10.197l-.085-.939zm42.923-23.339c-1.92-1.92-3.84-2.603-6.4-2.603-3.157 0-6.357.683-8.917 2.603-3.2 2.603-5.077 6.4-5.077 10.24v1.237l-5.845 281.984 3.243 51.84 2.603 50.56c0 6.997 6.315 13.397 13.995 13.397 7.723 0 14.08-6.4 14.08-14.037l6.4-102.997-6.4-283.179c0-5.12-3.157-9.429-7.04-11.819zm381.824 158.379c-17.28 0-33.92 3.669-48.597 9.899-10.24-113.237-104.96-202.069-221.355-202.069-28.117 0-55.68 5.76-80.597 15.317-9.6 3.84-11.52 7.68-12.16 15.317v399.701c.683 7.68 6.4 14.08 14.08 14.72h349.227c69.077.683 125.355-54.955 125.355-124.672s-56.277-125.952-125.355-125.952z"/>
                        </svg>
                        Profil SoundCloud
                      </a>
                    </li>}
                  {links.mc &&
                    <li>
                      <a href={links.mc} title={"Profil Mixcloud de " + name}>
                        <svg className="icon-mixcloud" viewBox="0 0 1024 1024" aria-hidden="true">
                          <path fill="#314359" d="M936.533 813.312a34.29 34.29 0 0 1-18.987-5.76c-15.744-10.667-19.84-32-9.6-47.36 31.488-46.677 48-101.589 48-158.677s-16.512-112-48-158.763c-10.624-15.701-6.187-36.949 9.216-47.189 16-10.624 37.12-6.229 47.275 9.131 39.125 58.24 59.563 126.72 59.563 197.12 0 70.315-20.437 138.837-59.563 197.077-5.76 10.197-16.64 15.317-27.52 15.317l-.384-.896z"/><path fill="#314359" d="M838.827 758.101c-6.528 0-13.141-1.92-18.987-5.931-15.744-10.197-19.755-31.317-9.173-46.677 20.864-30.763 31.872-65.92 31.872-103.68 0-36.48-11.008-72.32-31.872-103.723-10.581-15.36-6.571-36.437 9.173-46.72s36.565-6.4 47.189 9.6c28.544 42.24 43.563 91.52 43.563 141.397 0 51.243-15.019 99.84-43.563 141.44-6.229 10.24-17.323 15.36-28.203 15.36V758.1zM679.68 452.907C666.283 316.502 550.997 209.75 410.88 209.75c-116.096 0-218.88 74.581-255.787 182.741C67.754 405.376 0 480.811 0 571.734c0 100.011 81.579 181.504 181.76 181.504h465.408c83.797 0 152.149-68.011 152.149-151.765 0-72.789-51.2-133.504-119.68-148.48v-.085zm-32.512 232.362h-465.28c-62.549 0-113.877-50.816-113.877-113.408 0-62.507 50.901-113.408 113.877-113.408 30.293 0 58.923 12.16 80.469 33.323 12.8 13.397 34.603 13.397 48 0 12.8-12.843 12.8-34.603 0-48-23.68-23.125-52.523-39.723-83.84-47.403 32-71.04 103.68-118.357 183.68-118.357 111.317 0 202.24 90.837 202.24 202.155 0 21.845-3.2 42.923-10.24 63.403-5.76 17.92 3.84 37.077 21.76 43.52 3.157 1.28 7.04 1.92 10.24 1.92 14.08 0 27.52-9.003 32-23.04 4.48-13.44 7.68-26.88 9.6-40.96 31.317 12.16 53.76 42.88 53.76 78.08 0 46.763-37.76 84.437-83.84 84.437l1.451-2.261z"/>
                        </svg>
                        Profil Mixcloud
                      </a>
                    </li>}
                  {links.ra &&
                    <li>
                      <a href={links.ra} title={"Page Resident Advisor de " + name}>
                        <img className="icon-ra" src="/assets/img/ra.png" alt="" />
                        Resident Advisor
                      </a>
                    </li>}
                </ul>
              </div>
            </div>
            {nextEvents.length > 0 &&
              <div className="Performer-events">
                <h2>Prochains festivals ({nextEvents.length})</h2>
                <ul>
                  {nextEvents.map(e => <EventMinicard key={e.id} event={e} />)}
                </ul>
              </div>}
            {pastEvents.length > 0 &&
              <div className="Performer-events pastEvents">
                <h2>Festivals pass√©s</h2>
                <ul>
                  {pastEvents.map(e => <EventMinicard key={e.id} event={e} />)}
                </ul>
              </div>}
          </div>
        </main>
        {links.sc &&
          <aside role="complementary">
            <iframe className="Performer-player" id="SCPlayer"
              src={"https://w.soundcloud.com/player/?url=" + encodeURIComponent(links.sc)
              + "&buying=false&show_comments=false"}
              scrolling="no" frameBorder="no"></iframe>
          </aside>}
      </div>
    )
  }
}
